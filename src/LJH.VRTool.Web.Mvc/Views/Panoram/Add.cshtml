@model LJH.VRTool.Web.Models.Test.User
<div class="modal-body">
    <form id="commentForm">
        <div class="form-group">
            <label class="col-sm-3 control-label">作品名称：</label>
            <div class="col-sm-8">
                <input id="cname" name="name" minlength="2" type="text" class="form-control" required="" aria-required="true">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">作品分类</label>
            <div class="col-sm-10">
                <select class="form-control m-b" name="account">
                    <option>选项 1</option>
                    <option>选项 2</option>
                    <option>选项 3</option>
                    <option>选项 4</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">说明：</label>
            <div class="col-sm-8">
                <textarea id="ccomment" name="comment" class="form-control" required="" aria-required="true"></textarea>
            </div>
        </div>
        <div class="form-group">
            <div class="layui-upload">
                <button type="button" class="layui-btn layui-btn-normal" id="test-upload-change">选择本地文件</button>
                <button type="button" class="layui-btn" id="test2">选择全景素材</button>
                <button type="button" class="layui-btn ayui-btn-normal" id="test-upload-change-action">开始上传</button>
                <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                    预览图：
                    <div class="layui-upload-list" id="demo2"></div>
                </blockquote>
            </div>
        </div>
    </form>
</div>
<script src="~/lib/jquery/dist/jquery.js"></script>
@section scripts
    {
    <script>
    layui.use('upload', function () {
            var $ = layui.jquery
                , upload = layui.upload;
            upload.render({
            elem: '#test-upload-change'
            ,url: '/upload/'
            ,auto: false
            ,bindAction: '#test-upload-change-action'
            ,done: function(res){
             console.log(res)
              }
        });
        //多图片上传
         upload.render({
           elem: '#test2'
           ,url: '/upload/'
           ,multiple: true
           ,before: function(obj){
             //预读本地文件示例，不支持ie8
             obj.preview(function(index, file, result){
               $('#demo2').append('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
             });
           }
           ,done: function(res){
             //上传完毕
           }
         });
    });
     //保存
    function save(){
      var formData = $("#addForm").serializeArray();
        $.ajax({
          url: "@Url.Action("Add", "Home")",
          type: "POST",
          data: formData,
          dataType: "json",
          success: function (res) {
              if (res.result.status == "ok") {
                  parent.location.reload();//刷新父窗口
                  var index = parent.layer.getFrameIndex(window.name);
                  parent.layer.close(index); //再执行关闭
              }
              else {
                  alert("error");
              }
          },
          error: function (e) {
              console.log(e);
          }
      });
    }
    </script>
}
